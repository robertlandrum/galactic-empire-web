/**************************************************************************************** *									Scrores.c											* *																						* *	Copyright © 1989 Blueridge Technologies, Inc. All right reserved.					* *																						* *	Author:	R.C. Landrum																* *	Date:	25 Jul 90																	* *																						* ****************************************************************************************//******************************************************************************** *		Does the about dialog.													* ********************************************************************************/#include "Galaxy.h"#define		I_OK			1#define		I_Erase_Scores	2#define		I_Name			4							/* T  L  B  R	*/static Rect		rnames[5]={	144,28,160,142,		/* Names */						 	170,28,186,142,						 	196,28,212,142,						 	222,28,238,142,						 	248,28,264,142};						 	static Rect		ryears[5]={	144,148,160,190,	/* Years */							170,148,186,190,							196,148,212,190,							222,148,238,190,							248,148,264,190};							static Rect		renems[5]={	144,232,170,394,	/* Enemy list */							170,232,196,394,							196,232,222,394,							222,232,248,394,							248,232,274,394};ScoreHandle		scores = 0L;extern	short	elist[8];extern	short	curryear;extern	short	totenemies;extern	short	prefsRefNum;void Scores(short req)/* req = CHECKSCORE or SHOWSCORES */{DialogPtr      	dp;         						/* Dialog pointer			*/	short    		DType;Handle    		DItem;Rect    		tempRect;GrafPtr			sp;									/* Saved port				*/Str255			t,t2;short			item,i;short			saveResFile = CurResFile();	if(prefsRefNum != (-1))UseResFile(prefsRefNum);scores=(ScoreHandle)Get1Resource(ScoreType,ScoreRID);if(scores == 0L)	{	scores = (ScoreHandle)NewHandle((long)sizeof(ScoreRec));	if(scores == 0L)		{		ParamText("\pCould not create scores resource","\p","\p","\p");		MyStopAlert(STOPALRT,0L);		return;		}		/* Initialize data to default values and create the new resource */	Erase_Scores();				if(prefsRefNum != (-1))UseResFile(prefsRefNum);		AddResource((Handle)scores,ScoreType,ScoreRID,"\pHigh Scores");	}UseResFile(saveResFile);switch(req)	{	case CHECKSCORE:		{		for(i=0;i<5;i++)			{			/* Check if more aliens than anyone else first */						if(totenemies > (**scores).ecount[i])				{				/* Put it here and move everyone down 1 */				Add_Score(i);				break;				}			/* Do a years check - saveable score if same alien count and better years */			else if((totenemies == (**scores).ecount[i]) && (curryear < (**scores).years[i]))				{				Add_Score(i);				break;				}			}		if(i==5)	/* Not a saveable score */			{			GetPort(&sp);  			//PositionDialog('DLOG',5);			dp = GetNewDialog( 5, 0L,  (WindowPtr)-1L ); 						ShowWindow(dp);			SetPort(dp);			GetDItem(dp,I_OK, &DType, &DItem, &tempRect);			PenSize(3, 3);			InsetRect(&tempRect, -4, -4);			FrameRoundRect(&tempRect, 16, 16); 			PenSize(1, 1);						StartASound(kCloseButNoCigar); 			do				{				ModalDialog(0L, &item); 						} while (item != I_OK);			EndASound();			DisposDialog(dp);       										SetPort(sp);			return;			}		}	case SHOWSCORES:		{		GetPort(&sp);  		//PositionDialog('DLOG',3);		dp = GetNewDialog( 3, 0L,  (WindowPtr)-1L ); 					ShowWindow(dp);		SetPort(dp);		redo:		BeginUpdate(dp);		DrawDialog(dp);		EndUpdate(dp);		GetDItem(dp,I_OK, &DType, &DItem, &tempRect);		PenSize(3, 3);		InsetRect(&tempRect, -4, -4);		FrameRoundRect(&tempRect, 16, 16); 		PenSize(1, 1); 		TextFont(geneva);		HLock((Handle)scores);		for(i=0;i<5;i++)			{			TextSize(10);			EraseRect(&rnames[i]);			TextBox(&(**scores).names[i][1], (**scores).names[i][0], &rnames[i], teJustLeft);			if((**scores).years[i] > 0)				{				NumToString((long)((**scores).years[i]/10),t);				pStrCat("\p.",t);				NumToString((long)((**scores).years[i] % 10),t2);				pStrCat(t2,t);				}			else t[0]=0;			EraseRect(&ryears[i]);			TextBox(&t[1], t[0], &ryears[i], teJustRight);			TextSize(9);			EraseRect(&renems[i]);			TextBox(&(**scores).elist[i][1], (**scores).elist[i][0], &renems[i], teJustLeft);			}		HUnlock((Handle)scores);				/* Show the scores here */		do			{			ModalDialog(0L, &item); 				if(item == I_Erase_Scores)				{				Erase_Scores();				ChangedResource((Handle)scores);				WriteResource((Handle)scores);				goto redo;				}			} while (item != I_OK);		DisposeDialog(dp);       									SetPort(sp);		break;		}	}}void                                Erase_Scores(){if(scores != 0L)	{	(**scores).names[0][0] = 0;	(**scores).names[1][0] = 0;	(**scores).names[2][0] = 0;	(**scores).names[3][0] = 0;	(**scores).names[4][0] = 0;	(**scores).years[0] = 0;	(**scores).years[1] = 0;	(**scores).years[2] = 0;	(**scores).years[3] = 0;	(**scores).years[4] = 0;	(**scores).ecount[0] = 0;	(**scores).ecount[1] = 0;	(**scores).ecount[2] = 0;	(**scores).ecount[3] = 0;	(**scores).ecount[4] = 0;	(**scores).elist[0][0] = 0;	(**scores).elist[1][0] = 0;	(**scores).elist[2][0] = 0;	(**scores).elist[3][0] = 0;	(**scores).elist[4][0] = 0;	}}voidAdd_Score(short pos){short		i;DialogPtr	dp,sp;Rect    	tempRect;short    	DType;Handle    	DItem;Str255    	name,t,t2;short    	item;	 GetPort(&sp);  //PositionDialog('DLOG',4);dp = GetNewDialog(4, 0L,(WindowPtr)-1L);ShowWindow(dp);SelectWindow(dp);SetPort(dp); 	 GetDItem(dp,I_OK, &DType, &DItem, &tempRect);PenSize(3, 3);InsetRect(&tempRect, -4, -4);FrameRoundRect(&tempRect, 16, 16); PenSize(1, 1); GetDItem(dp,I_Name, &DType, &DItem, &tempRect);SetIText(DItem, "\pI Forgot My Name");SelIText(dp,I_Name,0,32767);StartASound(kLotsofCheers);do	{	ModalDialog(0L, &item);	} while (item != I_OK);EndASound(); GetDItem(dp,I_Name, &DType, &DItem, &tempRect);GetIText(DItem, name);/* Move current scores down 1 */HLock((Handle)scores);for(i=4;i>pos;i--)	{	pStrCopy((**scores).names[i-1],(**scores).names[i]);	(**scores).years[i] = (**scores).years[i-1];	(**scores).ecount[i] = (**scores).ecount[i-1];	pStrCopy((**scores).elist[i-1],(**scores).elist[i]);	}	/* Form the alien string */NumToString((long)totenemies,t2);pStrCopy("\p(",t);pStrCat(t2,t);pStrCat("\p) ",t);for(i=0;i<totenemies;i++)	{	switch(elist[i])		{		case GUBRU:		{pStrCat("\pGubrus, ",t);break;}			case CZIN:		{pStrCat("\pCzins, ",t);break;}			case BLOBS:		{pStrCat("\pBlobs, ",t);break;}			case BOTS:		{pStrCat("\pBots, ",t);break;}			case ARACHS:	{pStrCat("\pArachs, ",t);break;}			case MUTANTS:	{pStrCat("\pMutants, ",t);break;}			case NUKES:		{pStrCat("\pNukes, ",t);break;}			case BOZOS:		{pStrCat("\pBozos, ",t);break;}		}	}t[0] -= 2;	/* Kill last comma and space in alien list *//* Add the score to the list */pStrCopy(name,(**scores).names[pos]);(**scores).years[pos] = curryear;(**scores).ecount[pos] = totenemies;pStrCopy(t,(**scores).elist[pos]);	HUnlock((Handle)scores);ChangedResource((Handle)scores);WriteResource((Handle)scores);	DisposeDialog(dp);SetPort(sp); }